# Exploiting XXE to Extract Files, Perform SSRF, and Handle Blind XXE ðŸš¨

XXE (XML External Entity) is a vulnerability that allows attackers to extract files from a server, perform SSRF attacks, and exploit "blind" XXE vulnerabilities. This guide covers all these scenarios with detailed examples. ðŸ’¡

---

## Discovering Hidden Attack Surfaces for XXE Injection

The attack surface for XXE injection vulnerabilities is often apparent because typical HTTP traffic in an application includes requests containing XML data. However, in some cases, the attack surface is less obvious. By inspecting the right places, you can uncover XXE attack surfaces in requests that do not explicitly include XML.

### XInclude Attacks

Some applications take user-supplied data, embed it server-side into an XML document, and then parse the document. An example of this is when user-supplied data is included in a backend SOAP request, which is subsequently processed by a SOAP service.

In such cases, you cannot perform a classical XXE attack because you do not control the entire XML document and cannot define or modify a DOCTYPE element. However, you can leverage XInclude instead. XInclude is part of the XML specification that allows creating an XML document from subdocuments. You can place an XInclude attack in any data value within the XML document, making the attack possible even when you control only a single data element that gets embedded into a server-side XML document.

To perform an XInclude attack, you need to reference the XInclude namespace and specify the file path you want to include. For example:
```xml
<foo xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include parse="text" href="file:///etc/passwd"/>
</foo>
```

---

## Example Lab Exercise

In this lab, the "Check Stock" function embeds user-supplied data into a server-side XML document, which is subsequently parsed.

Since you do not control the entire XML document, you cannot define a DTD to launch a classical XXE attack.

To solve the lab, use an XInclude statement to extract the contents of the `/etc/passwd` file.

**Hint**: By default, XInclude will attempt to parse the included document as XML. Since `/etc/passwd` is not valid XML, you will need to add an additional attribute to the XInclude directive to change this behavior.

### Steps to Execute

### 1. Select a Product
You are presented with a list of products:

![Product List](https://github.com/user-attachments/assets/25e27f48-46e8-4a05-bb02-89e90a575410)

---

### 2. Click the Button
Navigate to any product, enable Burp Proxy, and click **"Check Stock"**:

![Check Stock Button](https://github.com/user-attachments/assets/10a3b074-fffe-434b-af2e-19cda4292f94)

---

### 3. Intercept the Request
In **Proxy â†’ HTTP History**, locate the POST request to `/product/check` and send it to **Repeater**:

![POST Request](https://github.com/user-attachments/assets/2aaeb314-7fab-4089-a953-86765eb9a944)

---

### 4. Insert the XInclude Payload
Change the `ProductId` value to:
```xml
<foo xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include parse="text" href="file:///etc/passwd"/>
</foo>
```

![Inserting the XInclude Payload](https://github.com/user-attachments/assets/a8dfa8d3-c741-4eb4-8583-b383083e9e7c)

---

### 5. Retrieve the Output
The contents of the `/etc/passwd` file should appear in the response:

![Output of /etc/passwd](https://github.com/user-attachments/assets/3399e0cd-2e48-4505-bd27-d2a44162825b)
